/*
ATBM-CQ-07
*/


ALTER SESSION SET "_ORACLE_SCRIPT" = TRUE;

-----------Table --------------

CREATE TABLE NHANSU (
    MANV VARCHAR2(10) PRIMARY KEY,
    HOTEN NVARCHAR2(50),
    PHAI NVARCHAR2(10),
    NGSINH DATE,
    PHUCAP INT,
    DT VARCHAR2(10),
    VAITRO NVARCHAR2(20),
    MADV VARCHAR2(10)
);

CREATE TABLE SINHVIEN (
    MASV VARCHAR2(10) PRIMARY KEY,
    HOTEN NVARCHAR2(50),
    PHAI NVARCHAR2(10),
    NGSINH DATE,
    DCHI NVARCHAR2(100),
    DT VARCHAR2(10),
    MACT VARCHAR2(10),
    MANGHANH VARCHAR2(10),
    SOTCTL INT,
    DTBTL NUMBER
);

CREATE TABLE DONVI (
    MADV VARCHAR2(10) PRIMARY KEY,
    TENDV NVARCHAR2(50),
    TRGDV VARCHAR2(10)
);

CREATE TABLE HOCPHAN (
    MAHP VARCHAR2(10) PRIMARY KEY,
    TENHP NVARCHAR2(80),
    SOTC INT,
    STLT INT,
    STTH INT,
    SOSVTD INT,
    MADV VARCHAR2(10)
);


CREATE TABLE KHMO (
    MAHP VARCHAR2(10),
    HK INT,
    NAM INT,
    MACT VARCHAR2(10),
    PRIMARY KEY(MAHP, HK, NAM, MACT)
);


CREATE TABLE PHANCONG (
    MAGV VARCHAR2(10),
    MAHP VARCHAR2(10),
    HK INT,
    NAM INT,
    MACT VARCHAR2(10),
    PRIMARY KEY(MAGV, MAHP, HK, NAM, MACT)
);


CREATE TABLE DANGKY (
    MASV VARCHAR2(10),
    MAGV VARCHAR2(10),
    MAHP VARCHAR2(10),
    HK INT,
    NAM INT,
    MACT VARCHAR2(10),
    DIEMTH NUMBER, 
    DIEMQT NUMBER, 
    DIEMCK NUMBER,
    DIEMTK NUMBER,
    PRIMARY KEY(MASV, MAGV, MAHP, HK, NAM, MACT)
);


ALTER TABLE NHANSU
ADD CONSTRAINT FK_NHANSU_DONVI
FOREIGN KEY (MADV) REFERENCES DONVI(MADV);

ALTER TABLE DONVI
ADD CONSTRAINT FK_DONVI_NHANSU
FOREIGN KEY (TRGDV) REFERENCES NHANSU(MANS);

ALTER TABLE HOCPHAN
ADD CONSTRAINT FK_HOCPHAN_DONVI
FOREIGN KEY (MADV) REFERENCES DONVI(MADV);

ALTER TABLE KHMO
ADD CONSTRAINT FK_KHMO_HOCPHAN
FOREIGN KEY (MAHP) REFERENCES DONVI(MAHP);

ALTER TABLE PHANCONG
ADD CONSTRAINT FK_PHANCONG_NHANSU
FOREIGN KEY (MAGV) REFERENCES NHANSU(MANS);

ALTER TABLE PHANCONG
ADD CONSTRAINT FK_PHANCONG_KHMO
FOREIGN KEY (MAHP, HK, NAM, MACT) REFERENCES KHMO(MAHP, HK, NAM, MACT);

ALTER TABLE DANGKY
ADD CONSTRAINT FK_DANGKY_SINHVIEN
FOREIGN KEY (MASV) REFERENCES SINHVIEN(MASV);

ALTER TABLE DANGKY
ADD CONSTRAINT FK_DANGKY_PHANCONG
FOREIGN KEY (MAGV, MAHP, HK, NAM, MACT) REFERENCES PHANCONG(MAGV, MAHP, HK, NAM, MACT);


----- Data ---


INSERT INTO NHANSU (MANV, HOTEN, PHAI, NGSINH, PHUCAP, DT, VAITRO, MADV)
VALUES ('NV01', 'Nguyen Van A', 'Nam', TO_DATE('1990-01-01', 'YYYY-MM-DD'), 5000000, '0123456789', 'Giang vien', 'DV01');
INSERT INTO NHANSU (MANV, HOTEN, PHAI, NGSINH, PHUCAP, DT, VAITRO, MADV)
VALUES ('NV02', 'Le Thi B', 'Nu', TO_DATE('1991-02-01', 'YYYY-MM-DD'), 4500000, '0123456780', 'Giang vien', 'DV02');
INSERT INTO NHANSU (MANV, HOTEN, PHAI, NGSINH, PHUCAP, DT, VAITRO, MADV)
VALUES ('NV03', 'Tran Van C', 'Nam', TO_DATE('1992-03-01', 'YYYY-MM-DD'), 5500000, '0987654321', 'Giang vien', 'DV03');


INSERT INTO SINHVIEN (MASV, HOTEN, PHAI, NGSINH, DCHI, DT, MACT, MANGHANH, SOTCTL, DTBTL)
VALUES ('SV01', 'Tran Van D', 'Nam', TO_DATE('2000-04-01', 'YYYY-MM-DD'), '123 Street', '0987654321', 'CT01', 'NG01', 120, 8.5);
INSERT INTO SINHVIEN (MASV, HOTEN, PHAI, NGSINH, DCHI, DT, MACT, MANGHANH, SOTCTL, DTBTL)
VALUES ('SV02', 'Nguyen Thi E', 'Nu', TO_DATE('2001-05-01', 'YYYY-MM-DD'), '456 Street', '0123456789', 'CT02', 'NG02', 121, 8.0);
INSERT INTO SINHVIEN (MASV, HOTEN, PHAI, NGSINH, DCHI, DT, MACT, MANGHANH, SOTCTL, DTBTL)
VALUES ('SV03', 'Le Van F', 'Nam', TO_DATE('2002-06-01', 'YYYY-MM-DD'), '789 Street', '0123456780', 'CT03', 'NG03', 122, 7.5);


INSERT INTO DONVI (MADV, TENDV, TRGDV)
VALUES ('DV01', 'Don vi 1', 'NV01');
INSERT INTO DONVI (MADV, TENDV, TRGDV)
VALUES ('DV02', 'Don vi 2', 'NV02');
INSERT INTO DONVI (MADV, TENDV, TRGDV)
VALUES ('DV03', 'Don vi 3', 'NV03');


INSERT INTO HOCPHAN (MAHP, TENHP, SOTC, STLT, STTH, SOSVTD, MADV)
VALUES ('HP01', 'Hoc phan 1', 3, 30, 15, 60, 'DV01');
INSERT INTO HOCPHAN (MAHP, TENHP, SOTC, STLT, STTH, SOSVTD, MADV)
VALUES ('HP02', 'Hoc phan 2', 4, 40, 20, 80, 'DV02');
INSERT INTO HOCPHAN (MAHP, TENHP, SOTC, STLT, STTH, SOSVTD, MADV)
VALUES ('HP03', 'Hoc phan 3', 5, 50, 25, 100, 'DV03');


INSERT INTO KHMO (MAHP, HK, NAM, MACT)
VALUES ('HP01', 1, 2022, 'CT01');
INSERT INTO KHMO (MAHP, HK, NAM, MACT)
VALUES ('HP02', 2, 2022, 'CT02');
INSERT INTO KHMO (MAHP, HK, NAM, MACT)
VALUES ('HP03', 1, 2023, 'CT03');


INSERT INTO PHANCONG (MAGV, MAHP, HK, NAM, MACT)
VALUES ('NV01', 'HP01', 1, 2022, 'CT01');
INSERT INTO PHANCONG (MAGV, MAHP, HK, NAM, MACT)
VALUES ('NV02', 'HP02', 2, 2022, 'CT02');
INSERT INTO PHANCONG (MAGV, MAHP, HK, NAM, MACT)
VALUES ('NV03', 'HP03', 1, 2023, 'CT03');


INSERT INTO DANGKY (MASV, MAGV, MAHP, HK, NAM, MACT, DIEMTH, DIEMQT, DIEMCK, DIEMTK)
VALUES ('SV01', 'NV01', 'HP01', 1, 2022, 'CT01', 8, 8, 8, 8);
INSERT INTO DANGKY (MASV, MAGV, MAHP, HK, NAM, MACT, DIEMTH, DIEMQT, DIEMCK, DIEMTK)
VALUES ('SV02', 'NV02', 'HP02', 2, 2022, 'CT02', 7, 7, 7, 7);
INSERT INTO DANGKY (MASV, MAGV, MAHP, HK, NAM, MACT, DIEMTH, DIEMQT, DIEMCK, DIEMTK)
VALUES ('SV03', 'NV03', 'HP03', 1, 2023, 'CT03', 9, 9, 9, 9);

------ Create Role------

CREATE ROLE basic_employee_role;
CREATE ROLE lecturer_role;
CREATE ROLE academic_staff_role;
CREATE ROLE unit_head_role;
CREATE ROLE department_head_role;
CREATE ROLE student_role;


------- Create User --- 


CREATE USER SV01 IDENTIFIED BY 1;
CREATE USER SV02 IDENTIFIED BY 2;
CREATE USER SV03 IDENTIFIED BY 3;

GRANT CREATE SESSION TO SV01;
GRANT CREATE SESSION TO SV02;
GRANT CREATE SESSION TO SV03;










